<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수도권 전동차 정보</title>
    <script src = "https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity = "sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin = "anonymous"></script>
    <link rel = "stylesheet" href = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity = "sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin = "anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <script src = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity = "sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin = "anonymous"></script>
    <script src = "https://kit.fontawesome.com/06fb83cb17.js" crossorigin = "anonymous"></script>
    <link rel="stylesheet" href="https://potato179.github.io/style/potato-min.css">
</head>
<body>
    <main class = "container center">
        <h1>오늘은 어떤 달구지가 올까요?</h1>
        <button onclick = "loadDoc('1호선')">1호선</button>
        <button onclick = "loadDoc('2호선')">2호선</button>
        <button onclick = "loadDoc('3호선')">3호선</button>
        <button onclick = "loadDoc('4호선')">4호선</button>
        <button onclick = "loadDoc('5호선')">5호선</button>
        <button onclick = "loadDoc('6호선')">6호선</button>
        <button onclick = "loadDoc('7호선')">7호선</button>
        <button onclick = "loadDoc('8호선')">8호선</button>
        <button onclick = "loadDoc('9호선')">9호선</button>
        <button onclick = "loadDoc('경의중앙선')">경의중앙선</button>
        <button onclick = "loadDoc('경춘선')">경춘선</button>
        <button onclick = "loadDoc('신분당선')">신분당선</button>
        <button onclick = "loadDoc('공항철도')">공항철도</button>
        <button onclick = "loadDoc('우이신설선')">우이신설선</button>
        <br><br>
        <table id = "demo" class = "center" style = "width: 100%"></table>
    </main>
    <script>
        function loadDoc(lineno) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                myFunction(lineno, this);
                }
            };
            xhttp.open("GET", `http://swopenapi.seoul.go.kr/api/subway/7141685873706f7434376d4f6d4e74/xml/realtimePosition/0/1000/${lineno}`, true);
            xhttp.send();
        }
        function myFunction(lineno, xml) {
            var i;
            var xmlDoc = xml.responseXML;
            var table = "<tr><th>상행</th><th>하행</th></tr>";
            var x = xmlDoc.getElementsByTagName("row");
            for (i = 0; i < x.length; i++) { 
                let arrived;
                if(x[i].getElementsByTagName("trainSttus")[0].childNodes[0].nodeValue === 1) arrived = "접근";
                else if(x[i].getElementsByTagName("trainSttus")[0].childNodes[0].nodeValue === 2) arrived = "도착";
                else arrived = "출발";

                if(x[i].getElementsByTagName("updnLine")[0].childNodes[0].nodeValue == 0){
                    table += `<tr>
                        <td><img src="./${lineno}.png" style = "width: 4em;"><br>${x[i].getElementsByTagName("trainNo")[0].childNodes[0].nodeValue}<br>${x[i].getElementsByTagName("statnTnm")[0].childNodes[0].nodeValue}행<br>${x[i].getElementsByTagName("statnNm")[0].childNodes[0].nodeValue} ${arrived}<br><br></td>
                        <td></td>
                    </tr>`;
                }
                else if(x[i].getElementsByTagName("updnLine")[0].childNodes[0].nodeValue == 1){
                    table += `<tr>
                        <td></td>
                        <td><img src="./${lineno}.png" style = "width: 4em;"><br>${x[i].getElementsByTagName("trainNo")[0].childNodes[0].nodeValue}<br>${x[i].getElementsByTagName("statnTnm")[0].childNodes[0].nodeValue}행<br>${x[i].getElementsByTagName("statnNm")[0].childNodes[0].nodeValue} ${arrived}<br><br></td>
                    </tr>`;
                }

            }
            document.getElementById("demo").innerHTML = table;
        }
    </script>
</body>
</html>